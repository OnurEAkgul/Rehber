<div class="container">
  <h1 class="mt-3">Kişilerim</h1>

  <div class="d-flex justify-content-end mt-3">
    <a [routerLink]="['/islem/kaydet/', user?.userId]" class="btn btn-primary">Yeni kişi ekle</a>
  </div>



  <ng-container *ngIf="!showDetails; else detailsView">

    <div class="justify-content-center">
      <input type="text" pInputText [(ngModel)]="searchTerm" (input)="onSearch()" />
    </div>

    <!-- Table view -->
    <div class="table-responsive mt-3">

      <table class="table table-bordered">

        <thead>
          <tr>
            <th>Name</th>
            <th>Surname</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Güncelle</th>
            <th>Sil</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let item of rehberList$ | async">

            <td (click)="onRowClick(item)">{{ item.name.length > 25 ? (item.name | slice: 0:25) + '...' : item.name }}
            </td>

            <td (click)="onRowClick(item)">{{ item.surname.length > 25 ? (item.surname | slice: 0:25) + '...' :
              item.surname }}</td>

            <td (click)="onRowClick(item)">{{ item.email.length > 25 ? (item.email | slice: 0:20) + (item.email.length >
              28 ? '...' + item.email.slice(-10) : '') : item.email }}</td>

            <td (click)="onRowClick(item)">{{ item.phone.length > 25 ? (item.phone | slice: 0:25) + '...' : item.phone
              }}</td>

            <td class="d-flex justify-content-center">
              <a class="btn btn-light" [routerLink]="['/islem/guncelle', item.userId, item.id]">Güncelle</a>
            </td>

            <td>

              <button type="button" class="btn btn-danger ms-3" (click)="onDelete(item.id)"
                [disabled]="deleteInProgress">

                <span *ngIf="deleteInProgress" class="spinner-border spinner-border-sm me-2" role="status"aria-hidden="true"></span>
                  Kullanıcıyı sil
              
                </button>

            </td>
          </tr>
        
        </tbody>
      
      </table>
    
    </div>
  
  </ng-container>

  <ng-template #detailsView>
    <!-- Details view -->
    
    <div class="table-responsive mt-3">
      
      <table class="table table-bordered">
        
        <thead>
          <tr>
            <th>Name</th>
            <th>Surname</th>
            <th>Email</th>
            <th>Phone</th>
          </tr>
        </thead>
       
        <tbody>
          
          <tr>
            <td>{{ selectedPerson?.name?.length ? (selectedPerson?.name | slice: 0:25) : selectedPerson?.name}}
            </td>
            
            <td>{{ selectedPerson?.surname?.length ? (selectedPerson?.surname | slice: 0:25) :
              selectedPerson?.surname}}</td>
           
           <td *ngIf="selectedPerson">{{ selectedPerson.email
              ? selectedPerson.email.length > 25
              ? (selectedPerson.email | slice: 0:20) +
              (selectedPerson.email.length > 28 ? '...' + selectedPerson.email.slice(-10) : '')
              : selectedPerson.email
              : 'N/A' }}
            </td>
            
            <td>{{ selectedPerson?.phone?.length ? (selectedPerson?.phone | slice: 0:25) :
              selectedPerson?.phone}}</td>
              </tr>
        
            </tbody>
      
          </table>
      
          <button class="btn btn-primary" (click)="goBackToList()">Go Back</button>
    </div>
  </ng-template>
</div>